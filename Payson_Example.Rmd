---
title: "Payson - Test"
author: "Greg Macfarlane"
date: "3/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(tidyverse)
library(leaflet)
```


Let's create  a network for the Payson region. We will create a bounding box
for the area we want to look at.

```{r region}
payson <- st_read("data/payson_bb.geojson")
```

We put a bunch of functions in an R script.
```{r cars}
source("R/build_linknode_tables.R")
```


One of these functions will download the March 2021 version of the AGRC 
multimodal network database.

```{r getdata}
download_gbd()
```


The next function turns the shapes in the GDB into a list of two tables:
   - `links` An SF object
   - `nodes` A table of nodes

```{r payson_net}
payson_net <- extract_roads(payson, "data/MM_NetworkDataset_03042021.gdb/")

plot(payson_net$links[, "speed"])
```


Now that we have this network, we need to join the travel demand model
information to it.

```{r segments}
segs_with_factors <- st_read("data/segs_with_factors.geojson")
seggment
```

```{r map}
leaflet() %>%
  addProviderTiles(providers$Esri.WorldGrayCanvas) %>%
  addPolylines(data = payson_net$links, color = "black") %>%
  addPolylines(data = segs_with_factors, color = "red")
```



We can then write out the network to a set of files
```{r writeout}
write_linknodes(payson_net, "data/payson")
```

